<template>
    <div>

        <section class="hero-slider" style="background-image: url('../../../static/img/rocket-image.png');">
            <div class="item">
                <div class="container padding-top-4x">
                    <div class="row justify-content-end align-items-right">
                        <div class="col-lg-4 col-md-6 padding-bottom-2x text-md-left text-center">
                            <div class="grid-item align-items-right">
                                <div class="product-card">
                                    <div class="rating-stars"><i class="icon-star filled"></i><i
                                            class="icon-star filled"></i><i class="icon-star filled"></i><i
                                            class="icon-star filled"></i><i class="icon-star filled"></i>
                                    </div>
                                    <a class="product-thumb" href="shop-single.html"><img
                                            src="../../static/img/shop/products/11.jpg" alt="Product"></a>
                                    <h3 class="product-title"><a href="shop-single.html">Top-Sider Fathom</a></h3>
                                    <h4 class="product-price">$90.00</h4>
                                    <div class="product-buttons">
                                        <button class="btn btn-outline-secondary btn-sm btn-wishlist"
                                                data-toggle="tooltip" title="Whishlist"><i class="icon-heart"></i>
                                        </button>
                                        <button class="btn btn-outline-primary btn-sm" data-toast
                                                data-toast-type="success" data-toast-position="topRight"
                                                data-toast-icon="icon-circle-check" data-toast-title="Product"
                                                data-toast-message="successfuly added to cart!">Add to Cart
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </section>

        <!-- Featured Products Carousel-->
        <section class="container padding-top-3x padding-bottom-3x">
            <h3 class="text-left mb-30">Today's Top ICOs</h3>
            <div class="owl-carousel"
                 data-owl-carousel="{ &quot;nav&quot;: false, &quot;dots&quot;: true, &quot;margin&quot;: 30, &quot;responsive&quot;: {&quot;0&quot;:{&quot;items&quot;:1},&quot;576&quot;:{&quot;items&quot;:2},&quot;768&quot;:{&quot;items&quot;:3},&quot;991&quot;:{&quot;items&quot;:4},&quot;1200&quot;:{&quot;items&quot;:4}} }">
                <!-- Product-->
                <div class="grid-item">
                    <div class="product-card">
                        <div class="product-badge text-danger">22% Off</div>
                        <a class="product-thumb" href="shop-single.html"><img
                                src="../../static/img/shop/products/09.jpg" alt="Product"></a>
                        <h3 class="product-title"><a href="shop-single.html">Rocket Dog</a></h3>
                        <h4 class="product-price">
                            <del>$44.95</del>
                            $34.99
                        </h4>
                        <div class="product-buttons">
                            <button class="btn btn-outline-secondary btn-sm btn-wishlist" data-toggle="tooltip"
                                    title="Whishlist"><i class="icon-heart"></i></button>
                            <button class="btn btn-outline-primary btn-sm" data-toast data-toast-type="success"
                                    data-toast-position="topRight" data-toast-icon="icon-circle-check"
                                    data-toast-title="Product" data-toast-message="successfuly added to cart!">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Product-->
                <div class="grid-item">
                    <div class="product-card">
                        <div class="rating-stars"><i class="icon-star filled"></i><i class="icon-star filled"></i><i
                                class="icon-star filled"></i><i class="icon-star filled"></i><i class="icon-star"></i>
                        </div>
                        <a class="product-thumb" href="shop-single.html"><img
                                src="../../static/img/shop/products/03.jpg" alt="Product"></a>
                        <h3 class="product-title"><a href="shop-single.html">Oakley Kickback</a></h3>
                        <h4 class="product-price">$155.00</h4>
                        <div class="product-buttons">
                            <button class="btn btn-outline-secondary btn-sm btn-wishlist" data-toggle="tooltip"
                                    title="Whishlist"><i class="icon-heart"></i></button>
                            <button class="btn btn-outline-primary btn-sm" data-toast data-toast-type="success"
                                    data-toast-position="topRight" data-toast-icon="icon-circle-check"
                                    data-toast-title="Product" data-toast-message="successfuly added to cart!">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Product-->
                <div class="grid-item">
                    <div class="product-card"><a class="product-thumb" href="shop-single.html"><img
                            src="../../static/img/shop/products/12.jpg" alt="Product"></a>
                        <h3 class="product-title"><a href="shop-single.html">Vented Straw Fedora</a></h3>
                        <h4 class="product-price">$49.50</h4>
                        <div class="product-buttons">
                            <button class="btn btn-outline-secondary btn-sm btn-wishlist" data-toggle="tooltip"
                                    title="Whishlist"><i class="icon-heart"></i></button>
                            <button class="btn btn-outline-primary btn-sm" data-toast data-toast-type="success"
                                    data-toast-position="topRight" data-toast-icon="icon-circle-check"
                                    data-toast-title="Product" data-toast-message="successfuly added to cart!">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Product-->
                <div class="grid-item">
                    <div class="product-card">
                        <div class="rating-stars"><i class="icon-star filled"></i><i class="icon-star filled"></i><i
                                class="icon-star filled"></i><i class="icon-star filled"></i><i
                                class="icon-star filled"></i>
                        </div>
                        <a class="product-thumb" href="shop-single.html"><img
                                src="../../static/img/shop/products/11.jpg" alt="Product"></a>
                        <h3 class="product-title"><a href="shop-single.html">Top-Sider Fathom</a></h3>
                        <h4 class="product-price">$90.00</h4>
                        <div class="product-buttons">
                            <button class="btn btn-outline-secondary btn-sm btn-wishlist" data-toggle="tooltip"
                                    title="Whishlist"><i class="icon-heart"></i></button>
                            <button class="btn btn-outline-primary btn-sm" data-toast data-toast-type="success"
                                    data-toast-position="topRight" data-toast-icon="icon-circle-check"
                                    data-toast-title="Product" data-toast-message="successfuly added to cart!">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- ======== @Region: #content ======== -->
        <div id="content" class="pb-6 bg-white pos-relative pos-zindex-10">
            <!-- Main content -->
            <div class="container pb-6">
                <div class="row">

                    <!-- Main content -->
                    <div class="col-lg-12">
                        <div class="row">
                            <div class="col-sm-3">
                                <h3 class="text-left mb-2"><a>Active ICOs</a>
                                </h3>
                            </div>
                            <div class="col-sm-3">
                                <h3 class="text-center mb-2">Upcoming ICOs

                                </h3>
                            </div>

                            <div class="col-sm-3">
                                <h3 class="text-right mb-2">Passed ICOs
                                </h3>
                            </div>
                            <div class="col-sm-3">
                                <h3 class="text-right mb-2">Filters
                                </h3>
                            </div>
                        </div>
                        <hr class="mb-4"/>
                        <!-- Job 1 -->
                        <div v-if="loaded">
                            <div class="product-card product-list"
                                 v-for="project in posts"
                                 v-if="loaded&&project.status===1">
                                <a class="product-thumb" href="#" @click="postModal(project.id)">
                                    <img :src="project.logo_image" alt="Logo">
                                </a>
                                <div class="product-info" @click="postModal(project.id)">
                                    <h3 class="product-title">
                                        {{project.title}}

                                        <span class="float-right text-bold text-info ml-2">{{project.rating}}/100</span>
                                    </h3>

                                    <h4 class="product-price">
                                        {{formatTime(project.start_datetime, project.end_datetime)}}</h4>
                                    <p> {{project.description_short}}</p>
                                    <div class="row">
                                        <div class="col-sm-8">
                                            ICO Process
                                            <div class="progress">
                                                <div class="progress-bar bg-info" role="progressbar"
                                                     style="width: 70%; height: 5px;"
                                                     aria-valuenow="70" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                        <div class="col-sm-2 float-right">
                                            <button class="btn btn-outline-danger btn-sm float-right">
                                                <span><i class="fa fa-star-o"></i> Mark for me</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Call to action -->
                        <!--<div v-scroll-at="loadMore"></div>-->
                        <div class="row">
                            <div class="col-md-12 text-md-center mt-0 mb-5">
                                <a class="btn btn-primary btn-md btn-rounded text-white">
                                    + More
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
  export default {
    name: 'Landing',
    head: {
      title: {
        inner: 'ICOToday',
        complement: 'Find Your Next ICO',
      }
    },
    data () {
      return {
        upcoming: false,
        current: true,
        loaded: false,
        page: 1,
      }
    },
    methods: {
      getMonth () {
        /* global moment:true */
        return moment().format('MMM YYYY')
      },
      loadMore () {
        this.$store.dispatch('listPostsByPage')
          .then(() => {
            this.page += 1
          })
          .catch(() => {
          })
      },
      formatTime (start, end) {
        /* global moment:true */
        // Haven't start
        if (moment().diff(start, 'minutes') < 0) {
          return 'Start: ' + moment(start).format('MM/DD, hh:mm')
        } else {
          return 'End: ' + moment(end).format('MM/DD, hh:mm')
        }
      },
      postModal (id) {
        /* global $:true */
        this.$store.dispatch('getPost', id)
          .then(() => {
            $('#post-modal').modal('show')
          })
      }
    },
    computed: {
      posts () {
        return this.$store.getters.posts
      },
      promo_posts () {
        return this.$store.getters.promo_posts
      },
      logedin () {
        return this.$store.getters.login_status
      },
      me () {
        return this.$store.getters.self
      }
    },
    beforeCreate () {
      this.$store.dispatch('listPosts')
        .then(() => {
          this.loaded = true
        })
        .catch(() => {
        })
      this.$store.dispatch('listPromoPosts')
        .then(() => {
          this.loaded = true
        })
        .catch(() => {
        })
    },
    mounted () {
    },

    directives: {
      'scroll-at': {
        /**
         * @example: <div v-scroll-at.bottom="loadMore"></div>
         */

        _bind () {
          this.el.addEventListener('scroll', this.scrollHandler)
        },
        _unbind () {
          this.el.removeEventListener('scroll', this.scrollHandler)
        },
        bind () {
          let loading = false
          let done = () => { loading = false }

          this.scrollHandler = () => {
            let triggerTop = this.modifiers.top || false
            let distance = this.el.scrollTop
            let scrollMax = this.el.scrollHeight - this.el.clientHeight
            let trigger = triggerTop ? distance < 10 : distance > scrollMax - 10

            if (this.handler && !loading && trigger) {
              loading = true

              let result = this.handler()

              if (result === undefined) done()
              else if (result.then && result.then.call) result.then(done, done)
              else done()
            }
          }

          this._bind()
        },
        update (value) {
          this.handler = value
          value.unbind = () => this._unbind()
          value.bind = () => this._bind()
        },
        unbind () {
          this._unbind()
        }
      }
    },
  }

</script>
